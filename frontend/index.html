<!DOCTYPE html>
<html>
<head>
  <title>PIC++</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>PIC++</h1>
  <form id="simulation-form">
    <label for="param1">Parameter 1:</label>
    <input type="text" id="param1" name="param1">
    <br>
    <label for="param2">Parameter 2:</label>
    <input type="text" id="param2" name="param2">
    <br>
    <input type="submit" value="Run Simulation">
  </form>
  <div id="result"></div>
  <div id="visualization"></div>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  
  <script>
    $(document).ready(function() {
      $('#simulation-form').submit(function(event) {
        event.preventDefault(); // Prevent form submission

        // Get form data
        var param1 = $('#param1').val();
        var param2 = $('#param2').val();

        // Make AJAX request to the API endpoint
        $.ajax({
          url: 'http://127.0.0.1:8000/run-simulation/',  // Replace with your API endpoint URL
          method: 'GET',
          data: {param1: param1, param2: param2},
          success: function(response) {
            // Display the result
            // $('#result').text(response);
            // console.log(response);

            // Parse JSON response
        var jsonData = JSON.parse(response);
        console.log(jsonData);

           // Set the width and height of the visualization
var width = 800;
var height = 400;
var margin = { top: 20, right: 20, bottom: 30, left: 40 };

// Create an SVG element within the 'visualization' container
var svg = d3.select('#visualization')
  .append('svg')
  .attr('width', width)
  .attr('height', height);

// Extract positions and velocities from the JSON data
var positions = jsonData.positions;
var velocities = jsonData.velocities;

// Combine positions and velocities into a single array of objects
var data = positions.map(function(position, index) {
  return { x: position, y: velocities[index] };
});

// Define the x-scale for positions
var xScale = d3.scaleLinear()
  .domain([d3.min(positions), d3.max(positions)])
  .range([0, width]);

// Define the y-scale for velocities
var yMin = -1;
var yMax = 1;
var yScale = d3.scaleLinear()
  // .domain([d3.min(velocities), d3.max(velocities)])
  .domain([yMin, yMax])
  .range([height, 0]);

// Create circles for each data point
svg.selectAll('circle')
  .data(data)
  .enter()
  .append('circle')
  .attr('cx', function(d) { return xScale(d.x); })
  .attr('cy', function(d) { return yScale(d.y); })
  .attr('r', 5)
  .style('fill', 'steelblue');

  // Calculate the inner width and height (excluding margins)
var innerWidth = width - margin.left - margin.right;
var innerHeight = height - margin.top - margin.bottom;

// Create a group element for the main content and apply margins
var g = svg.append('g')
  .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

// Define the x-scale for positions
var xScale = d3.scaleLinear()
  .domain([d3.min(positions), d3.max(positions)])
  .range([0, innerWidth]);

// Define the y-scale for velocities
var yScale = d3.scaleLinear()
  .domain([yMin, yMax])
  .range([innerHeight, 0]);

// Create x-axis
var xAxis = d3.axisBottom(xScale);
g.append('g')
  .attr('transform', 'translate(0,' + innerHeight + ')')
  .call(xAxis);

// Create y-axis
var yAxis = d3.axisLeft(yScale);
g.append('g')
  .call(yAxis);

// Add border to the graph
svg.append('rect')
  .attr('x', margin.left)
  .attr('y', margin.top)
  .attr('width', innerWidth)
  .attr('height', innerHeight)
  .style('fill', 'none')
  .style('stroke', 'black')
  .style('stroke-width', '1px');

// Add x-axis label
svg.append('text')
  .attr('x', width / 2)
  .attr('y', height - 5)
  .style('text-anchor', 'middle')
  .text('Positions');

// Add y-axis label
svg.append('text')
  .attr('transform', 'rotate(-90)')
  .attr('x', -height / 2)
  .attr('y', 15)
  .style('text-anchor', 'middle')
  .text('Velocities');

          },
          error: function(xhr, textStatus, errorThrown) {
            // Handle error
            console.log('Error:', textStatus);
          }
        });
      });
    });
  </script>
  <style>
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #visualization {
      width: 800px;
      height: 400px;
      margin-bottom: 20px;
    }

    #result {
      width: 800px;
      height: 100px;
      background-color: lightgray;
      padding: 10px;
    }
  </style>
</body>
</html>